"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9325],{"../../packages/logging/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>T,qn:()=>C});__webpack_require__("../../node_modules/console-browserify/index.js");function C(s,t){null!=__webpack_require__.g&&__webpack_require__.g.applicationInsights&&__webpack_require__.g.applicationInsights.logTrace(s,t)}function T(s,t){null!=__webpack_require__.g&&__webpack_require__.g.applicationInsights&&__webpack_require__.g.applicationInsights.logError(s,t)}},"../../packages/search/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AB:()=>nt,BP:()=>ve,_b:()=>D,bc:()=>N,hw:()=>Ve,oD:()=>P});var axios__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/axios/index.js"),axios__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/next/dist/compiled/react/index.js"),process=__webpack_require__("../../node_modules/process/browser.js"),console=__webpack_require__("../../node_modules/console-browserify/index.js"),c=(h,e,t)=>new Promise(((r,a)=>{var s=d=>{try{i(t.next(d))}catch(p){a(p)}},o=d=>{try{i(t.throw(d))}catch(p){a(p)}},i=d=>d.done?r(d.value):Promise.resolve(d.value).then(s,o);i((t=t.apply(h,e)).next())})),P=class{getSearchResults(e){return c(this,null,(function*(){var o,i,d,p;if(!e)throw new Error("[SearchService] No search results parameters.");if(e.limit<=0||e.offset<0)throw new Error("[SearchService] Invalid pagination parameters provided.");if(!e.locale||""===e.locale)throw new Error("[SearchService] No locale provided");let t={content:{},offset:e.offset,limit:e.limit,query:{keyphrase:this.normalizeSearchText(e.searchText)},facet:{all:null!=(o=e.allFacets)&&o,types:null!=(d=null==(i=e.facets)?void 0:i.map((g=>({name:g.name,sort:{name:g.sortBy,order:"asc"},max:100}))))?d:null},sort:e.sort&&""!==e.sort?{value:[{name:e.sort}]}:void 0,filter:null!=(p=e.filter)?p:void 0},r={widget:{items:[{entity:this._entity,rfk_id:this._widgetId,sources:[this._source],search:t}]},context:{locale:this.getLocaleSettings(e.locale)}},s=(yield this._client.post("/",r,this.getRequestHeaders())).data;if(!s)throw new Error("Null search service response received.");return s}))}normalizeSearchText(e){return e&&e.length>0?e:null}getRequestHeaders(){let e=process.env.SITECORE_SEARCH_API_KEY;if(!e||""===e)throw new Error("No API Key");return{headers:{Authorization:e}}}getLocaleSettings(e){let t=process.env.NEXT_PUBLIC_SITECORE_SEARCH_ALLOWED_LOCALES;if(!t||""===t)throw new Error("[SearchService] 'NEXT_PUBLIC_SITECORE_SEARCH_ALLOWED_LOCALES' environment value has no value.");let a=t.split(",").find((o=>o.toLowerCase().startsWith(e.toLowerCase())));if(!a)throw new Error(`[SearchService] Couldn't resolve locale settings for locale: ${e}, available locales: ${t}.`);let s=a.split("_");if(2!==s.length)throw new Error(`[SearchService] Invalid locale format: ${a}`);return{language:s[0],country:s[1]}}constructor(e,t,r){if(!e||""===e)throw new Error("No source provided.");if(this._source=e,!t||""===t)throw new Error("No widget Id provided.");if(this._widgetId=t,!r||""===r)throw new Error("No entity provided.");this._entity=r;let a=process.env.SITECORE_SEARCH_ENDPOINT_URL;if(!a||""===a)throw new Error("No Search Service Endpoint URL.");this._client=axios__WEBPACK_IMPORTED_MODULE_0___default().create({baseURL:a,timeout:1e4})}},L="text",H="Match At Least One Tag",O="Do Not Match Tags",N=class{getSearchResult(e){return c(this,null,(function*(){let t=new URLSearchParams,r={type:"and",filters:[]};this.addSearchSourceParameters(t),this.addPagingParameters(t,e),this.addSortingParameters(t,e),this.addSearchTextParameter(t,e),this.addRetrieveFacetParameters(t,e);let a=this.applyFacets(e);a&&r.filters.push(a);let s=this.applyTemplateFilter(e);s&&r.filters.push(s);let o=this.applyTagFilter();return o&&r.filters.push(o),e.filter&&r.filters.push(e.filter),this.fetchSearchResults(t,r)}))}addSearchSourceParameters(e){var t;e.set("sourceId",null!=(t=this._searchConfig.sourceId)?t:""),e.set("entity",this._searchConfig.entity)}addPagingParameters(e,t){var o,i;let r=0;t.pageIndex&&(r=t.pageIndex);let a=null!=(o=this._scopeConfig.pageSize)?o:9,s=null!=(i=this._scopeConfig.startFrom)?i:0;0!==r&&(s=r*a+s),e.set("offset",s.toString()),e.set("limit",a.toString())}addSortingParameters(e,t){var a,s,o;let r=null!=(o=t.sort)?o:null==(s=null==(a=this._scopeConfig)?void 0:a.sort)?void 0:s.fieldName;r&&e.set("sort",r)}addSearchTextParameter(e,t){t.searchText&&t.searchText.length>0&&e.set("searchText",t.searchText)}addRetrieveFacetParameters(e,t){if(e.set("allFacets",t.allFacets.toString()),!t.allFacets){let r=this._scopeConfig.facets.map((a=>{let s=L;return a.sortBy&&""!==a.sortBy&&(s=a.sortBy.toLowerCase()===L?L:"count"),{name:a.indexSourceFieldName,sortBy:s}}));r.length>0&&e.set("facets",JSON.stringify(r))}}applyFacets(e){if(0===e.selectedFacets.length)return;let t={type:"and",filters:[]};return e.facetData.forEach((r=>{var s;let a=this._scopeConfig.facets.find((o=>o.indexSourceFieldName.toLowerCase()===r.name.toLowerCase()));if(a){let o={type:"or"===(null==(s=a.combineFacetValuesLogicalOperator)?void 0:s.toLowerCase())?"or":"and",filters:[]};r.value.forEach((i=>{e.selectedFacets.includes(i.id)&&o.filters.push({type:"eq",name:r.name,value:i.text})})),o.filters.length>0&&t.filters.push(o)}else console.warn("[SearchResultProvider] Facet data contains facet not defined in search scope.")})),t}applyTemplateFilter(e){return 0===this._scopeConfig.filterOnTemplates.length?void 0:{type:"or",filters:this._scopeConfig.filterOnTemplates.map((r=>({type:"eq",name:"templates",value:r})))}}applyTagFilter(){if(0===this._scopeConfig.tagsFilter.length||!this._scopeConfig.tagsFilterBehavior)return;if(this._scopeConfig.tagsFilterBehavior!==O&&"Match All Tags"!==this._scopeConfig.tagsFilterBehavior&&this._scopeConfig.tagsFilterBehavior!==H)throw new Error("[SearchResultProvider] Invalid tag filter behavior provided.");let e={type:this._scopeConfig.tagsFilterBehavior===H||this._scopeConfig.tagsFilterBehavior===O?"or":"and",filters:[]};return this._scopeConfig.tagsFilter.forEach((t=>{e.filters.push({name:"tags",type:"eq",value:t})})),this._scopeConfig.tagsFilterBehavior!==O?e:{type:"not",filter:e}}fetchSearchResults(e,t){return c(this,null,(function*(){var i,d;let r=`/api/search/${this._searchConfig.language}/get-search-result?${e.toString()}`;t.filters.length>0&&(r+=`&filter=${encodeURIComponent(JSON.stringify(t))}`);let a=yield this._httpClient.get(r);if(a.status<200||a.status>299)throw new Error("[SearchResultProvider] Non successfull status code from search service proxy.");let s=a.data;if(!s)throw new Error("[SearchResultProvider] No response data from search service proxy received.");let o=s.widgets.length>0?s.widgets[0]:null;if(!o)throw new Error("[SearchResultProvider] No widget data in search service response.");return{facets:null!=(i=o.facet)?i:[],content:(null!=(d=o.content)?d:[]).map((p=>p)),totalSearchResultItemCount:o.total_item,hasNext:o.total_item>o.limit+o.offset}}))}constructor(e,t){if(this._searchConfig=e,this._scopeConfig=t,!e)throw new Error("[SearchResultProvider] No Search configuration provided.");if(!t)throw new Error("[SearchResultProvider] No Search scope configuration provided.");let a=process.env.NEXT_PUBLIC_WEB_API_PROXY_HOSTNAME;if(!a||""===a)throw new Error("'NEXT_PUBLIC_WEB_API_PROXY_HOSTNAME' environment value has no value.");this._httpClient=axios__WEBPACK_IMPORTED_MODULE_0___default().create({baseURL:"",timeout:1e4})}},D=class{getSearchScope(e,t){return c(this,null,(function*(){if(!e||""===e)throw new Error("[SearchScopeApiProxy] Scope Id is not defined or empty.");if(!t||""===t)throw new Error("[SearchScopeApiProxy] Language is not defined or empty.");let r=`/api/search/${t}/get-search-scope?scope=${e}`;try{return(yield this._httpClient.get(r)).data}catch(a){return console.error("[SearchScopeApiProxy] Failed request to search scope proxy API."),void console.error(a)}}))}createHttpClient(){let t=process.env.NEXT_PUBLIC_WEB_API_PROXY_HOSTNAME;if(!t||""===t)throw new Error("[SearchScopeApiProxy] 'NEXT_PUBLIC_WEB_API_PROXY_HOSTNAME' environment value has no value.");return axios__WEBPACK_IMPORTED_MODULE_0___default().create({baseURL:"",timeout:1e4})}constructor(){this._httpClient=this.createHttpClient()}};function ve(h,e){return c(this,null,(function*(){if(!h)throw new Error("Search service is not defined.");if(!e)throw new Error("Parameters are not defined.");let t=yield h.getSearchResults(e),r=(null==t?void 0:t.widgets.length)>0?t.widgets[0]:void 0;if(!r)throw new Error("[getSearchResults] No response widget in the search service.");return r.content?r.content:[]}))}function Ve(h,e){return c(this,null,(function*(){if(!h)throw new Error("Search service is not defined.");if(!e)throw new Error("Parameters are not defined.");let t=yield ve(h,e);if(0!==t.length)return t[0]}))}var nt=(h,e,t,r,a)=>{var B,M,U,q;if(!h)throw new Error("[useSearchContext] No Search config provided");if(!e)throw new Error("[useSearchContext] No Scope config provided.");let[s,o]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(void 0),[i,d]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(void 0),[p,g]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]),[T,_]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null!=(B=null==a?void 0:a.facets)?B:[]),[E,y]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(void 0),[w,F]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(0),[A,V]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null!=(M=null==a?void 0:a.content)?M:[]),[X,W]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null!=(U=null==a?void 0:a.totalSearchResultItemCount)?U:0),[b,Y]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null!=(q=null==a?void 0:a.hasNext)&&q),[z,G]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),k=n=>n?t?{type:"and",filters:[t,n]}:n:t,R=(n,u,l,f)=>c(void 0,null,(function*(){G(!0);let v=new N(h,e),S=j(n,l),m=yield v.getSearchResult(S);W(m.totalSearchResultItemCount),Y(m.hasNext),V(f?f(m):m.content),u&&_(m.facets),G(!1)})),j=(n,u)=>{let l=n.searchText,f=n.facetData,v=n.selectedFacets,S=n.pageIndex,m=n.sortField,x=n.filter;return u&&(l=null!=l?l:i,f=null!=f?f:T,v=null!=v?v:p,S=null!=S?S:w,m=null!=m?m:E,x=null!=x?x:s),{searchText:l,allFacets:!1,facetData:null!=f?f:[],selectedFacets:null!=v?v:[],pageIndex:S,sort:null!=m?m:r,filter:k(x)}};return[{filter:s,searchText:i,selectedFacets:p,facetData:T,sortField:E,pageIndex:w,searchResult:A,totalSearchResultCount:X,hasNext:b,loading:z,updateFilter:(n,u=!0)=>c(void 0,null,(function*(){o(n),F(0),u&&(yield R({filter:n,pageIndex:0},!1,!0))})),updateFilterAndFacets:(n,u,l=!0)=>c(void 0,null,(function*(){g(u),o(n),F(0),l&&(yield R({filter:n,selectedFacets:u,pageIndex:0},!1,!0))})),updateSearchText:(n,u=!0)=>c(void 0,null,(function*(){d(n),F(0),u&&(yield R({searchText:n,pageIndex:0},!1,!0))})),updateSortField:(n,u=!0)=>c(void 0,null,(function*(){y(n),u&&(yield R({sortField:n},!1,!0))})),updateFacets:(n,u=!0)=>c(void 0,null,(function*(){let l=[...p];if(n.checked)l.push(n.value);else{let f=l.indexOf(n.value);f>-1&&l.splice(f,1)}g(l),F(0),u&&(yield R({selectedFacets:l,pageIndex:0},!1,!0))})),toggleFacets:(n,u=!0)=>c(void 0,null,(function*(){let l=[...p],f=[],v=[];n.forEach((S=>{l.includes(S)?v.push(S):f.push(S)})),l=l.filter((S=>!v.includes(S))),l=l.concat(f),g(l),F(0),u&&(yield R({selectedFacets:l,pageIndex:0},!1,!0))})),loadMore:()=>c(void 0,null,(function*(){if(!b)return;let n=[...A],u=w+1;F(u),yield R({pageIndex:u},!1,!0,(l=>n.concat(l.content)))})),loadPage:n=>c(void 0,null,(function*(){if(n<0)throw new Error("Page index are not allowed to be less than 0.");F(n),yield R({pageIndex:n},!1,!0)})),loadSearchResult:(n,u)=>c(void 0,null,(function*(){(n||u)&&g([]),yield R({selectedFacets:n||u?[]:p,pageIndex:0},n,!0)})),reset:()=>c(void 0,null,(function*(){g([]),d(void 0),y(void 0),o(void 0),F(0),yield R({selectedFacets:[],searchText:void 0,sortField:void 0,filter:void 0,pageIndex:void 0},!1,!1)}))}]}}}]);